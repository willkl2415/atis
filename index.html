<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ATIS Demo</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --page-yellow:#FFFF00;
      --control-width: 820px; /* matches the screenshot proportions */
      --control-radius: 6px;
      --gold:#deb62f;
      --border:#cfcfcf;
      --text:#222;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background:var(--page-yellow);
      font-family:'Roboto',sans-serif;
      color:var(--text);
    }

    /* Outer center column */
    .wrap{
      width: min(96vw, 980px);
      margin: 18px auto 64px;
    }

    /* Intro white card (exactly like the screenshot) */
    .intro{
      width: var(--control-width);
      background:#fff;
      border:1px solid var(--border);
      border-radius: 8px;
      padding: 18px 24px;
      line-height:1.45;
      margin: 8px auto 18px;
      box-shadow: 0 1px 0 rgba(0,0,0,.02);
    }
    .intro h2{
      margin:0 0 10px 0;
      font-size:16px;
      font-weight:700;
    }
    .intro p{
      margin:8px 0;
      font-size:14px;
    }
    .intro strong{
      font-weight:700;
    }

    /* Labels + controls */
    .field{
      width: var(--control-width);
      margin: 16px auto 0;
    }
    .label{
      font-size:14px;
      font-weight:700;
      margin: 0 0 6px 0;
    }
    select, textarea{
      width:100%;
      border:1px solid var(--border);
      border-radius: var(--control-radius);
      padding: 10px 12px;
      font-size:14px;
      background:#fff;
      outline: none;
    }
    textarea{
      min-height: 140px;
      resize: vertical;
    }

    /* Submit button (small, left-aligned) */
    .actions{
      width: var(--control-width);
      margin: 14px auto 0;
    }
    button{
      background: var(--gold);
      border: none;
      color:#000;
      border-radius: var(--control-radius);
      padding: 10px 16px;
      font-size:14px;
      cursor:pointer;
    }
    button:disabled{opacity:.6;cursor:not-allowed}

    /* Response box – white, same width, looks like your screenshot */
    .response{
      width: var(--control-width);
      margin: 16px auto 0;
      background:#fff;
      border:1px solid var(--border);
      border-radius:8px;
      min-height: 54px;
      padding: 14px 16px;
      line-height:1.45;
      white-space:pre-wrap;
      font-size:14px;
    }
    .muted{opacity:.75;font-style:italic}
    /* Title line at very top like your page */
    .title{
      text-align:left;
      width: var(--control-width);
      margin: 10px auto 0;
      font-weight:700;
      font-size:16px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="title">Welcome to ATIS — a simple concept with mind-blowing results.</div>

    <div class="intro">
      <p>You have a question about your work, a task, a decision, or something you’re unsure about — and ATIS responds instantly with clear, helpful guidance. No setup, no jargon, no delay — just the answer you need, exactly when and where you need it.</p>
      <p>Whether you’re travelling, preparing for something important, solving a problem on the spot, or double‑checking a detail in the moment — ATIS is always ready.</p>
      <p>It’s the pinnacle of in‑the‑moment performance support — helping you feel more confident, capable, and informed, wherever you are.</p>
      <p><strong>ATIS isn’t just performance support — it’s the end of waiting for answers.</strong></p>
    </div>

    <div class="field">
      <div class="label">Sector</div>
      <select id="sector"><option value="">Select a sector</option></select>
    </div>

    <div class="field">
      <div class="label">Function</div>
      <select id="function"><option value="">Select a function</option></select>
    </div>

    <div class="field">
      <div class="label">Role</div>
      <select id="role"><option value="">Select a role</option></select>
    </div>

    <div class="field">
      <div class="label">Prompt</div>
      <textarea id="prompt" placeholder="Write or copy and paste your question here"></textarea>
    </div>

    <div class="actions">
      <button id="submitBtn">Submit Prompt</button>
    </div>

    <div id="response" class="response muted"></div>
  </div>

  <!-- DATA -->
  <script src="roles.js"></script>

  <!-- BEHAVIOUR (unchanged API behaviour; layout only changed) -->
  <script>
    const API_BASE = "https://atis-api.onrender.com";
    const ENDPOINT = "/generate";

    const sectorSelect = document.getElementById("sector");
    const functionSelect = document.getElementById("function");
    const roleSelect = document.getElementById("role");
    const promptInput = document.getElementById("prompt");
    const submitBtn = document.getElementById("submitBtn");
    const responseDiv = document.getElementById("response");

    function show(text, muted=false){
      responseDiv.classList.toggle("muted", muted);
      responseDiv.textContent = text;
    }

    function populateSectors(){
      sectorSelect.innerHTML = "<option value=''>Select a sector</option>";
      (window.ATIS_ROLES || []).forEach(sec=>{
        const opt=document.createElement("option");
        opt.value=sec.sector; opt.textContent=sec.sector;
        sectorSelect.appendChild(opt);
      });
    }
    function populateFunctions(){
      functionSelect.innerHTML = "<option value=''>Select a function</option>";
      roleSelect.innerHTML = "<option value=''>Select a role</option>";
      const sector=(window.ATIS_ROLES||[]).find(s=>s.sector===sectorSelect.value);
      if(sector){
        sector.functions.forEach(f=>{
          const opt=document.createElement("option");
          opt.value=f.name; opt.textContent=f.name;
          functionSelect.appendChild(opt);
        });
      }
    }
    function populateRoles(){
      roleSelect.innerHTML = "<option value=''>Select a role</option>";
      const sector=(window.ATIS_ROLES||[]).find(s=>s.sector===sectorSelect.value);
      if(sector){
        const func=sector.functions.find(f=>f.name===functionSelect.value);
        if(func){
          func.roles.forEach(r=>{
            const opt=document.createElement("option");
            opt.value=r; opt.textContent=r;
            roleSelect.appendChild(opt);
          });
        }
      }
    }

    async function submitPrompt(){
      const sector=sectorSelect.value;
      const func=functionSelect.value;
      const role=roleSelect.value;
      const prompt=promptInput.value.trim();

      if(!sector || !func || !role || !prompt){
        show("Please select sector, function, role, and enter a prompt.");
        return;
      }

      submitBtn.disabled=true;
      show("Thinking...", true);

      try{
        const res=await fetch(API_BASE+ENDPOINT,{
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body:JSON.stringify({sector, func, role, prompt})
        });

        const ct=res.headers.get("content-type")||"";
        if(!ct.includes("application/json")){
          const raw=await res.text();
          show("Non-JSON response from API:\n\n"+raw);
          return;
        }
        const data=await res.json();
        const text=data.text || data.response || data.message || data.detail;
        show(text ? String(text) : "Unexpected JSON from API:\n\n"+JSON.stringify(data,null,2));
      }catch(err){
        show("Network or CORS error:\n\n"+(err?.message||String(err)));
      }finally{
        submitBtn.disabled=false;
      }
    }

    sectorSelect.addEventListener("change", populateFunctions);
    functionSelect.addEventListener("change", populateRoles);
    submitBtn.addEventListener("click", submitPrompt);

    // Init
    show("");
    populateSectors();
  </script>
</body>
</html>
